<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verify Email - Paydas Portfolio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .bg-turkuaz { background-color: #0d9488; }
        .text-turkuaz { color: #0d9488; }
    </style>
</head>
<body class="bg-slate-50 flex items-center justify-center min-h-screen p-4 hidden" id="secure-body">

    <div class="max-w-md w-full bg-white rounded-2xl shadow-xl p-8 border border-slate-100 text-center relative overflow-hidden">
        
        <div class="absolute top-0 left-0 w-full h-2 bg-turkuaz"></div>

        <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-teal-50 mb-6">
            <svg class="h-10 w-10 text-turkuaz" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
            </svg>
        </div>

        <h2 class="text-2xl font-bold text-slate-900 mb-2">Check your inbox</h2>
        <p class="text-slate-500 mb-8 text-sm leading-relaxed">
            We've sent a verification link to <br>
            <span id="userEmailDisplay" class="font-bold text-slate-800">your email</span>.<br>
            Please click the link to activate your account.
        </p>

        <div class="space-y-4">
            <button id="checkStatusBtn" class="w-full bg-turkuaz text-white font-bold py-3 rounded-lg hover:bg-teal-700 transition shadow-md shadow-teal-500/20 flex justify-center items-center">
                <span>I've clicked the link</span>
            </button>

            <button id="resendBtn" class="w-full bg-white border-2 border-slate-200 text-slate-600 font-bold py-3 rounded-lg hover:bg-slate-50 hover:text-slate-900 transition">
                Resend verification email
            </button>
        </div>

        <p id="statusMessage" class="mt-6 text-sm font-medium hidden"></p>

        <div class="mt-8 pt-6 border-t border-slate-100">
            <button id="logoutBtn" class="text-sm text-slate-400 hover:text-red-500 font-medium transition">
                Sign in with a different account
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, sendEmailVerification, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

        // ⚠️ PASTE YOUR FIREBASE CONFIG HERE ⚠️
        const firebaseConfig = {
            apiKey: "AIzaSyBAbp5Kqv7PqyA7rFJAxvIqnzBRglSXJ5Q",
            authDomain: "paydas-potrfolio.firebaseapp.com",
            projectId: "paydas-potrfolio",
            storageBucket: "paydas-potrfolio.firebasestorage.app",
            messagingSenderId: "1064349640309",
            appId: "1:1064349640309:web:06e113a6cc7343db313a3c"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const statusMsg = document.getElementById('statusMessage');
        const checkStatusBtn = document.getElementById('checkStatusBtn');
        const resendBtn = document.getElementById('resendBtn');

        // --- AUTH GUARD & STATE MANAGER ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // If they are already verified, bypass this page entirely
                if (user.emailVerified) {
                    window.location.replace("dashboard.html");
                } else {
                    // Show the page and their email
                    document.getElementById('secure-body').classList.remove('hidden');
                    document.getElementById('userEmailDisplay').innerText = user.email;
                }
            } else {
                // No user logged in, send them to login
                window.location.replace("login.html");
            }
        });

        // --- CHECK VERIFICATION STATUS ---
        checkStatusBtn.addEventListener('click', async () => {
            if (auth.currentUser) {
                const originalText = checkStatusBtn.innerText;
                checkStatusBtn.innerText = "Checking...";
                checkStatusBtn.disabled = true;

                try {
                    // Force Firebase to fetch the latest user data from the server
                    await auth.currentUser.reload(); 
                    
                    if (auth.currentUser.emailVerified) {
                        statusMsg.innerText = "Verified! Redirecting...";
                        statusMsg.className = "mt-6 text-sm font-medium text-green-600";
                        statusMsg.classList.remove('hidden');
                        
                        setTimeout(() => {
                            window.location.replace("dashboard.html");
                        }, 1000);
                    } else {
                        statusMsg.innerText = "Email not verified yet. Please check your spam folder.";
                        statusMsg.className = "mt-6 text-sm font-medium text-red-500";
                        statusMsg.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error(error);
                } finally {
                    checkStatusBtn.innerText = originalText;
                    checkStatusBtn.disabled = false;
                }
            }
        });

        // --- RESEND EMAIL ---
        resendBtn.addEventListener('click', async () => {
            if (auth.currentUser) {
                const originalText = resendBtn.innerText;
                resendBtn.innerText = "Sending...";
                resendBtn.disabled = true;

                try {
                    await sendEmailVerification(auth.currentUser);
                    statusMsg.innerText = "A new verification email has been sent.";
                    statusMsg.className = "mt-6 text-sm font-medium text-turkuaz";
                    statusMsg.classList.remove('hidden');
                } catch (error) {
                    // Firebase limits how often you can send emails to prevent spam
                    if (error.code === 'auth/too-many-requests') {
                        statusMsg.innerText = "Please wait a few minutes before requesting another email.";
                    } else {
                        statusMsg.innerText = "Error sending email: " + error.message;
                    }
                    statusMsg.className = "mt-6 text-sm font-medium text-red-500";
                    statusMsg.classList.remove('hidden');
                } finally {
                    resendBtn.innerText = originalText;
                    setTimeout(() => resendBtn.disabled = false, 60000); // Disable for 1 minute
                }
            }
        });

        // --- LOGOUT ---
        document.getElementById('logoutBtn').addEventListener('click', () => {
            signOut(auth).then(() => window.location.replace("login.html"));
        });
    </script>
</body>
</html>
